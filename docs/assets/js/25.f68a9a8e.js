(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{396:function(a,e,s){"use strict";s.r(e);var n=s(29),t=Object(n.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"singleton-gof-üî®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#singleton-gof-üî®"}},[a._v("#")]),a._v(" Singleton (GOF) üî®")]),a._v(" "),s("p",[s("sup",{staticClass:"footnote-ref"},[s("a",{attrs:{href:"#fn1",id:"fnref1"}},[a._v("[1]")])])]),a._v(" "),s("p",[a._v("Em constru√ß√£o üöß")]),a._v(" "),s("h2",{attrs:{id:"intencao"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#intencao"}},[a._v("#")]),a._v(" Inten√ß√£o")]),a._v(" "),s("p",[a._v("Garantir que uma classe tenha somente uma inst√¢ncia e fornecer um ponto global de acesso para a mesma.")]),a._v(" "),s("h2",{attrs:{id:"motivacao"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#motivacao"}},[a._v("#")]),a._v(" Motiva√ß√£o")]),a._v(" "),s("p",[a._v("√â importante para algumas classes ter uma, e apenas uma, inst√¢ncia. Por exemplo, embora possam existir muitas impressoras em um sistema, deveria haver somente um spooler de impressoras. Da mesma forma, deveria haver somente um sistema de arquivos e um gerenciador de janelas. Um filtro digital ter√° somente um conversor A/ D. Um sistema de contabilidade ser√° dedicado a servir somente a uma companhia.")]),a._v(" "),s("p",[a._v("Como garantimos que uma classe tenha somente uma inst√¢ncia e que essa inst√¢ncia seja facilmente acess√≠vel? Uma vari√°vel global torna um objeto acess√≠vel, mas n√£o impede voc√™ de instanciar m√∫ltiplos objetos.")]),a._v(" "),s("p",[a._v("Uma solu√ß√£o melhor seria tornar a pr√≥pria classe respons√°vel por manter o controle da sua √∫nica inst√¢ncia. A classe pode garantir que nenhuma outra inst√¢ncia seja criada (pela intercepta√ß√£o das solicita√ß√µes para cria√ß√£o de novos objetos), bem como pode fornecer um meio para acessar sua √∫nica inst√¢ncia. Este √© o padr√£o Singleton.")]),a._v(" "),s("h2",{attrs:{id:"aplicabilidade"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aplicabilidade"}},[a._v("#")]),a._v(" Aplicabilidade")]),a._v(" "),s("p",[a._v("Use o padr√£o Singleton quando:")]),a._v(" "),s("ul",[s("li",[a._v("for preciso haver apenas uma inst√¢ncia de uma classe, e essa inst√¢ncia tiver que dar acesso aos clientes atrav√©s de um ponto bem conhecido;")]),a._v(" "),s("li",[a._v("a √∫nica inst√¢ncia tiver de ser extens√≠vel atrav√©s de subclasses, possibilitando aos clientes usar uma inst√¢ncia estendida sem alterar o seu c√≥digo.")])]),a._v(" "),s("h2",{attrs:{id:"estrutura"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#estrutura"}},[a._v("#")]),a._v(" Estrutura")]),a._v(" "),s("figure",[s("img",{attrs:{src:"https://www.plantuml.com/plantuml/svg/NOyn3eCm34Ltdy9ZkG9T6Bfqwi09ejIWIAdJ9ZyJukur2DI29zl_-UkxAt0PzHN9HrSAzq77A4Ww4LjD9YFucQk6JvMxsgnULgtiwCt17UcmSPVcI3xUaer8kWcZeFztiVLCf0d2KGPm6dw1sdPtvVKs2shMKx0hYJvvCQ3EEllh2m00",alt:"uml diagram"}}),a._v(" "),s("figcaption",[a._v("Estrutura Singleton.")])]),a._v(" "),s("h2",{attrs:{id:"participantes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#participantes"}},[a._v("#")]),a._v(" Participantes")]),a._v(" "),s("ul",[s("li",[a._v("Singleton\n"),s("ul",[s("li",[a._v("define uma opera√ß√£o "),s("code",[a._v("instance")]),a._v(" que permite aos clientes acessarem sua √∫nica inst√¢ncia. "),s("code",[a._v("instance")]),a._v(" √© uma opera√ß√£o de classe.")]),a._v(" "),s("li",[a._v("pode ser respons√°vel pela cria√ß√£o da sua pr√≥pria inst√¢ncia √∫nica.")])])])]),a._v(" "),s("h2",{attrs:{id:"colaboracoes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#colaboracoes"}},[a._v("#")]),a._v(" Colabora√ß√µes")]),a._v(" "),s("p",[a._v("‚Ä¢ Os clientes acessam uma inst√¢ncia Singleton unicamente pela opera√ß√£o "),s("code",[a._v("instance")]),a._v(" do Singleton.")]),a._v(" "),s("h2",{attrs:{id:"consequencias"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#consequencias"}},[a._v("#")]),a._v(" Consequ√™ncias")]),a._v(" "),s("p",[a._v("O padr√£o Singleton apresenta v√°rios benef√≠cios:")]),a._v(" "),s("ol",[s("li",[a._v("Acesso controlado √† inst√¢ncia √∫nica. Como a classe Singleton encapsula a sua √∫nica inst√¢ncia, possui controle total sobre como e quando os clientes a acessam.")]),a._v(" "),s("li",[a._v("Espa√ßo de nomes reduzido. O padr√£o Singleton representa uma melhoria em rela√ß√£o ao uso de vari√°veis globais. Ele evita a polui√ß√£o do espa√ßo de nomes com vari√°veis globais que armazenam inst√¢ncias √∫nicas.")]),a._v(" "),s("li",[a._v("Permite um refinamento de opera√ß√µes e da representa√ß√£o. A classe Singleton pode ter subclasses e √© f√°cil configurar uma aplica√ß√£o com uma inst√¢ncia dessa classe estendida. Voc√™ pode configurar a aplica√ß√£o com uma inst√¢ncia da classe de que necessita em tempo de execu√ß√£o.")]),a._v(" "),s("li",[a._v("Permite um n√∫mero vari√°vel de inst√¢ncias. O padr√£o torna f√°cil mudar de id√©ia, permitindo mais de uma inst√¢ncia da classe Singleton. Al√©m disso, voc√™ pode usar a mesma abordagem para controlar o n√∫mero de inst√¢ncias que a aplica√ß√£o utiliza. Somente a opera√ß√£o que permite acesso √† inst√¢ncia de Singleton necessita ser mudada("),s("a",{attrs:{href:"/nao_gof/Multiton"}},[a._v("Multiton")]),a._v(", "),s("a",{attrs:{href:"/nao_gof/ObjectPool"}},[a._v("Object Pool")]),a._v(").")]),a._v(" "),s("li",[a._v("Mais flex√≠vel do que opera√ß√µes de classe. Uma outra maneira de empacotar a funcionalidade de um singleton √© usando opera√ß√µes de classe (ou seja, fun√ß√µes-membro est√°ticas em C++ ou m√©todos de classe em Smalltalk). Por√©m, as t√©cnicas de ambas as linguagens tornam dif√≠cil mudar um projeto para permitir mais que uma inst√¢ncia de uma classe. Al√©m disso, as fun√ß√µes- membro est√°ticas em C++ nunca s√£o virtuais, o que significa que as subclasses n√£o podem redefini-las polimorficamente.")])]),a._v(" "),s("h2",{attrs:{id:"implementacao"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#implementacao"}},[a._v("#")]),a._v(" Implementa√ß√£o")]),a._v(" "),s("p",[a._v("A seguir apresentamos t√≥picos de implementa√ß√£o a serem considerados ao usar o\npadr√£o Singleton:")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("Garantindo uma √∫nica inst√¢ncia. O padr√£o Singleton torna a inst√¢ncia √∫nica uma inst√¢ncia normal de uma classe, mas essa classe √© escrita de maneira que somente uma inst√¢ncia possa ser criada.")]),a._v(" "),s("p",[a._v("Uma forma comum de fazer isso √© ocultando a opera√ß√£o que cria a inst√¢ncia usando uma opera√ß√£o de classe (isto √©, ou uma fun√ß√£o-membro est√°tica ou um m√©todo de classe) que garanta que apenas uma √∫nica inst√¢ncia seja criada. Esta opera√ß√£o tem acesso √† vari√°vel que mant√©m a √∫nica inst√¢ncia, e garante que a vari√°vel seja iniciada com a inst√¢ncia √∫nica antes de retornar ao seu valor. Esta abordagem assegura que um singleton seja criado e iniciado antes da sua primeira utiliza√ß√£o.")]),a._v(" "),s("p",[a._v("Em C++, vo√ß√™ pode definir a opera√ß√£o de classe com uma fun√ß√£o-membro est√°tica Instance da classe Singleton. Singleton tamb√©m define uma vari√°vel-membro est√°tica "),s("code",[a._v("_instance")]),a._v(" que cont√©m um apontador para sua √∫nica inst√¢ncia.")]),a._v(" "),s("p",[a._v("A classe "),s("code",[a._v("Singleton")]),a._v(" √© declarada como")]),a._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[a._v("class Singleton "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\npublic"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nprotected"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Singleton")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nprivate"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" _ instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("A implementa√ß√£o correspondente √© a seguinte")]),a._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[a._v("Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),a._v("_instance "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nSingleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("_instance "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        _instance "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" new Singleton"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" _instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("Os clientes acessam o singleton atrav√©s da fun√ß√£o membro "),s("code",[a._v("Instance")]),a._v(". A vari√°vel "),s("code",[a._v("_instance")]),a._v(" √© iniciada com 0, e a fun√ß√£o-membro est√°tica "),s("code",[a._v("Instance")]),a._v(" retorna o seu valor, iniciando-a com a √∫nica inst√¢ncia se ele for 0. "),s("code",[a._v("Instance")]),a._v(" usa "),s("em",[a._v("lazy initialization")]),a._v("; o valor que ela retorna n√£o √© criado e armazenado at√© ser acessado pela primeira vez.")]),a._v(" "),s("p",[a._v("Note que o constructor √© protegido. Um cliente que tenta instanciar "),s("code",[a._v("Singleton")]),a._v(" diretamente obter√° como resposta um erro em tempo de compila√ß√£o. Isto assegura que somente uma inst√¢ncia possa ser criada.")]),a._v(" "),s("p",[a._v("Al√©m do mais, uma vez que "),s("code",[a._v("_instance")]),a._v(" √© um apontador para um objeto "),s("code",[a._v("Singleton")]),a._v(", a fun√ß√£o-membro Instance pode atribuir um apontador para uma subclasse de "),s("code",[a._v("Singleton")]),a._v(" para esta vari√°vel. Daremos um exemplo do que dissemos aqui na se√ß√£o Exemplo de c√≥digo.")]),a._v(" "),s("p",[a._v("H√° uma outra coisa a ser observada sobre a implementa√ß√£o em C++. N√£o √© suficiente definir o singleton como um objeto global ou est√°tico, confiando numa inicializa√ß√£o autom√°tica. Existem tr√™s raz√µes para isto:")]),a._v(" "),s("ul",[s("li",[a._v("n√£o podemos garantir que somente uma inst√¢ncia de um objeto est√°tico ser√° declarada;")]),a._v(" "),s("li",[a._v("talvez n√£o tenhamos informa√ß√£o suficiente para instanciar cada singleton em tempo de inicializa√ß√£o est√°tica. Um singleton pode necessitar de valores que s√£o computados mais tarde, durante a execu√ß√£o do programa;")]),a._v(" "),s("li",[a._v("C++ n√£o define a ordem pela qual os construtores para objetos globais s√£o chamados entre unidades de compila√ß√£o [ES90]. Isso significa que n√£o podem existir depend√™ncias entre singletons; se alguma existir, ent√£o √© inevit√°vel a ocorr√™ncia de erro.")])]),a._v(" "),s("p",[a._v("Uma defici√™ncia adicional (embora pequena) da abordagem objeto global/ est√°tico √© que ela for√ßa a cria√ß√£o de todos singletons, quer sejam usados ou n√£o. O uso de uma fun√ß√£o-membro est√°tica evita todos estes problemas. Em Smalltalk, a fun√ß√£o que retorna a inst√¢ncia √∫nica √© implementada como um m√©todo de classe da classe Singleton. Para garantir que somente uma inst√¢ncia seja criada, redefine-se a opera√ß√£o new. A classe Singleton resultante pode ter os seguintes m√©todos de classe, em que "),s("code",[a._v("SoleInstance")]),a._v(" √© uma vari√°vel de classe que n√£o √© usada em nenhum outro lugar.")]),a._v(" "),s("div",{staticClass:"language-smalltalk line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-smalltalk"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("self")]),a._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'cannot create new object'")]),a._v("\ndefault\n    SoleInstance isNil ifTrue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Solelnstance "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("super")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("^")]),a._v(" Soleinstance\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v('Criando subclasses da classe Singleton. O ponto principal n√£o √© a defini√ß√£o da subclasse, mas sim a instala√ß√£o da sua √∫nica inst√¢ncia de maneira que os clientes possam ser capazes de us√°-la. Em ess√™ncia, a vari√°vel que referencia a inst√¢ncia do singleton deve ser iniciada com uma inst√¢ncia da subclasse. A t√©cnica mais simples √© determinar qual singleton voc√™ quer usar na opera√ß√£o Instance do Singleton. Um exemplo na se√ß√£o de Exemplo mostra como implementar essa t√©cnica com vari√°veis do ambiente (operacional). Uma outra maneira de escolher a subclasse de Singleton √© retirar a implementa√ß√£o de Instance da classe-m√£e (por exemplo, MazeFactory) e coloc√°-la na subclasse. Isto permite a um programador C++ decidir a classe do singleton em tempo de "Linkedi√ß√£o" (link-time), mantendo-a oculta dos seus clientes (por exemplo, fazendo a liga√ß√£o com um arquivo-objeto que cont√©m uma implementa√ß√£o diferente).\nA solu√ß√£o da liga√ß√£o fixa a escolha da classe do singleton em tempo de "linkedi√ß√£o", o que torna dif√≠cil escolher a classe do singleton em tempo de execu√ß√£o. O uso de instru√ß√µes condicionais para determina√ß√£o da subclasse √© mais flex√≠vel, por√©m codifica de maneira r√≠gida o conjunto das classes Singleton poss√≠veis. Nenhuma abordagem √© flex√≠vel o bastante em todos os casos.\nUma abordagem mais flex√≠vel utiliza um sistema de registro de singletons (registry of singletons). Em vez de ter Instance definindo o conjunto das classes Singleton poss√≠veis, as classes Singleton podem registrar suas inst√¢ncias singleton por nome, num sistema de registro de conhecimento geral. O sistema de registro associa nomes e singletons. Os nomes s√£o constitu√≠dos de cadeias de caracteres. Quando Instance necessita um singleton, ela consulta o sistema de registro, procurando o singleton pelo nome. O sistema de registro procura o singleton correspondente (se existir) e o retorna ao cliente. Essa solu√ß√£o libera Instance da necessidade de ter que conhecer todas as poss√≠veis classes ou inst√¢ncias do Singleton. Tudo o que √© necess√°rio √© uma interface comum para todas as classes Singleton, que inclua opera√ß√µes de registro:')]),a._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[a._v("class Singleton "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\npublic"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("char")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nprotected"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Lookup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("char")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nprivate"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" Singleton"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" _ instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("NameSingletonPair"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" _registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])])])]),a._v(" "),s("p",[a._v("Register registra a inst√¢ncia de Singleton com um nome fornecido. Para manter o registro simples, necessitaremos que armazene uma lista de objetos "),s("code",[a._v("NameSingletonPair")]),a._v(". Cada "),s("code",[a._v("NameSingletonPair")]),a._v(" mapeia (associa) um nomea um singleton. Dado um nome, a opera√ß√£o "),s("code",[a._v("Lookup")]),a._v(" encontra o singleton correspondente. Assumiremos que uma vari√°vel do ambiente especifica o nome do singleton desejado.")]),a._v(" "),s("p",[a._v("Singleton‚Ä¢ Singleton:: Instance ( ) {\ni f (_instance\nconst char‚Ä¢ singletonName = ;\n/ / usu√°rio ou ambiente fornece esse valor no in√≠cio da execu√ß√£o\n_ instance = Lookup (singletonName) ;\n// l√£)kup retorna O se n√£o h√° qualquer singleton com o nome verificado\nreturn _ instance;")]),a._v(" "),s("p",[a._v("Onde as classes Singleton registram a si mesmas? Uma possibilidade √© faz√™-\n10 no seu constructor. Por exemplo, uma subclasse MySing1eton poderia\nfazer o seguinte:")]),a._v(" "),s("p",[a._v('MySingIeton:: ( ) (\nSingleton:: Register( "MySing1eton*, this) ;')]),a._v(" "),s("p",[a._v("Naturalmente, o construtor n√£o ser√° chamado a menos que algu√©m instancie\na classe, o que repete o problema que o padr√£o Singleton est√° tentando resolver!\nN√≥s podemos contornar este problema em C++ atrav√©s da defini√ß√£o de uma\ninst√¢ncia est√°tica de MySingleton. Por exemplo, podemos definir")]),a._v(" "),s("p",[a._v("static MySing1eton theSingIeton;")]),a._v(" "),s("p",[a._v("no arquivo que cont√©m a implementa√ß√£o de MySingleton.")]),a._v(" "),s("p",[a._v("A classe Singleton n√£o √© mais respons√°vel pela cria√ß√£o do singleton. Em vez\ndisso, sua responsabilidade prim√°ria √© tornar acess√≠vel o objeto singleton\nescolhido no sistema. A solu√ß√£o que usa o objeto est√°tico ainda apresenta um\nproblema potencial ‚Äî todas as inst√¢ncias de todas as subclasses poss√≠veis de\nSingleton devem ser criadas, pois, caso contr√°rio, n√£o ser√£o registradas.")]),a._v(" "),s("h2",{attrs:{id:"exemplo-de-codigo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exemplo-de-codigo"}},[a._v("#")]),a._v(" Exemplo de c√≥digo")]),a._v(" "),s("p",[a._v("Suponha que definimos uma classe MazeFactory para construir labirintos. MazeFactory define uma interface para constru√ß√£o de diferentes partes de um labirinto. As subclasses podem redefinir as opera√ß√µes para retornar inst√¢ncias de classes-produtos especializadas, tal como BombedWall no lugar de simples Objetos Wall.")]),a._v(" "),s("p",[a._v("O fato relevante aqui √© que a aplica√ß√£o Maze necessita somente de uma inst√¢ncia de uma f√°brica de labirintos, e que essa inst√¢ncia dever√° estar dispon√≠vel para o c√≥digo que construir qualquer parte do labirinto. √â a√≠ que o padr√£o Singleton entra. Ao tornar MazeFactory um singleton, n√≥s tornamos o objeto-labirinto (maze) acess√≠vel global- mente sem recorrer a vari√°veis globais.")]),a._v(" "),s("p",[a._v("Para simplificar, suponhamos que nunca criaremos subclasses de Ma zeFactory (a alternativa ser√° considerada mais √† frente). N√≥s tornamos Ma uma classe Singleton em C++, acrescentando uma opera√ß√£o est√°tica Instance e um membro est√°tico "),s("code",[a._v("_instance")]),a._v(" para conter a √∫nica inst√¢ncia existente. Tamb√©m devemos proteger o constructor para prevenir instancia√ß√µes acidentais, as quais nos levariam a ter mais que uma inst√¢ncia.")]),a._v(" "),s("p",[a._v("class MazeFactory {\npubl i c :\nstatic MazeFactory* Instance ( ) ;\n// interface existente vai aqui\nprotected:\nMazeFactory ) ;\nprivate:\nstatic MazeFactory* _ instance;")]),a._v(" "),s("p",[a._v("A implementa√ß√£o correspondente √©\nMazeFactory* MazeFactory; : _ instance = C\nMazeFactory* MazeFactory:: Instance ( ) (\nii (_instance O) {\n_ instance new MazeFactory ;\nreturn _instance;")]),a._v(" "),s("p",[a._v("Agora verificaremos o que acontece quando existem subclasses de Ma zeFactory\ne a aplica√ß√£o tem que decidir qual delas usar. Selecionaremos o tipo de labirinto atrav√©s\nde uma vari√°vel do ambiente e acrescentaremos o c√≥digo que instancia a subclasse\napropriada de Ma z eFac tory com base no valor da vari√°vel do ambiente. Um bom lugar\npara colocar este c√≥digo √© a opera√ß√£o Instance, porque ela j√° instancia MazeFactory:")]),a._v(" "),s("p",[a._v('MazeFactory* MazeFactory :: Instance C) (\ni f C ‚Äîinstance ‚Äî\nconst chars mazeStyle = getenv( ) ;\ni f (strcmp (mazestyle, ‚Ä¢ bombed") O) (\n_ instance = new BombedMazeFactory;\n) else it (strcmp (mazeStyIe, "enchanted"}\n_ instance = new EnchantedMazeFactory;\noutras subclasses poss√≠veis\n) else {\n// default\n_ instance = new MazeFactory;\nreturn _ instance;')]),a._v(" "),s("p",[a._v("Note que Instance deve ser modificada toda vez que voc√™ define uma nova subclasse de MazeFactory. Isso pode n√£o ser um problema nesta aplica√ß√£o, mas pode ser um problema para as f√°bricas abstratas definidas num framework.")]),a._v(" "),s("p",[a._v("Uma solu√ß√£o poss√≠vel seria usar a t√©cnica do uso de um sistema de registro descrita na se√ß√£o Implementa√ß√£o. A liga√ß√£o din√¢mica (dynamic linking) poderia tamb√©m ser √∫til aqui ‚Äîela evitaria que a aplica√ß√£o tivesse que carregar para a mem√≥ria todas as subclasses que n√£o s√£o usadas.")]),a._v(" "),s("h2",{attrs:{id:"usos-conhecidos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usos-conhecidos"}},[a._v("#")]),a._v(" Usos conhecidos")]),a._v(" "),s("p",[a._v("Um exemplo do padr√£o Singleton em Smalltalk-80 [Par90] √© o conjunto de mudan√ßas no c√≥digo efetuado por ChangeSet current. Um exemplo mais sutil √© o relacionamento entre classes e suas metaclasses. Uma metaclasse √© a classe de uma classe, e cada metaclasse tem uma inst√¢ncia. As metaclasses n√£o t√™m nomes (exceto indiretamente, atrav√©s do nome da sua √∫nica inst√¢ncia), mas registram e acompanham a sua √∫nica inst√¢ncia, e normalmente n√£o criar√£o outra.")]),a._v(" "),s("p",[a._v("O toolkit para constru√ß√£o de interfaces de usu√°rio Inter Views [LCI*92] usa o padr√£o Singleton para acessar as √∫nicas inst√¢ncias de suas classes Session e WidgetKit, entre outras. Session define o ciclo de eventos dispar√°veis da aplica√ß√£o principal, armazena o banco de dados das prefer√™ncias de estilo do usu√°rio e administra conex√µes para um ou mais dispositivos f√≠sicos de display. WidgetKit √© uma Abstract Factory (95) para definir os widgets de estilo de intera√ß√£o. A opera√ß√£o WidgetKit:: instance determina a subclasse espec√≠fica de WidgetKit que √© instanciada baseada numa vari√°vel de ambiente que Session define. Uma opera√ß√£o similar em determina se s√£o suportados displays monocrom√°ticos ou coloridos e configura a inst√¢ncia singleton de Session de acordo.")]),a._v(" "),s("h2",{attrs:{id:"padrao-relacionados"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#padrao-relacionados"}},[a._v("#")]),a._v(" Padr√£o relacionados")]),a._v(" "),s("p",[a._v("Muitos padr√µes podem ser implementados usando Singleton. Ver "),s("a",{attrs:{href:"/gof/AbstractFactory"}},[a._v("Abstract Factory")]),a._v(", "),s("a",{attrs:{href:"/gof/Builder"}},[a._v("Builder")]),a._v(" e "),s("a",{attrs:{href:"/gof/Prototype"}},[a._v("Prototype")]),a._v(".")]),a._v(" "),s("h2",{attrs:{id:"referencias"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#referencias"}},[a._v("#")]),a._v(" Refer√™ncias")]),a._v(" "),s("hr",{staticClass:"footnotes-sep"}),a._v(" "),s("section",{staticClass:"footnotes"},[s("ol",{staticClass:"footnotes-list"},[s("li",{staticClass:"footnote-item",attrs:{id:"fn1"}},[s("p",[a._v("GAMMA, Erich. et al. Padr√µes de projetos: Solu√ß√µes reutiliz√°veis de software orientados a objetos Bookman editora, 2009. "),s("a",{staticClass:"footnote-backref",attrs:{href:"#fnref1"}},[a._v("‚Ü©Ô∏é")])])])])])])}),[],!1,null,null,null);e.default=t.exports}}]);
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Singleton (GOF) üî® | Padr√µes de Projetos</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css">
    <link rel="icon" href="/vuepressppr/logo.png">
    <link rel="manifest" href="/vuepressppr/manifest.json">
    <link rel="apple-touch-icon" href="/vuepressppr/icon-192x192.png">
    <link rel="mask-icon" href="/vuepressppr/icon-192x192.png" color="#3eaf7c">
    <meta name="description" content="Material para as aulas da disciplina de Padr√µes de Projetos">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icon-192x192.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/vuepressppr/assets/css/0.styles.47a93a5c.css" as="style"><link rel="preload" href="/vuepressppr/assets/js/app.8ac43990.js" as="script"><link rel="preload" href="/vuepressppr/assets/js/2.63c38da0.js" as="script"><link rel="preload" href="/vuepressppr/assets/js/24.ecdeccbb.js" as="script"><link rel="preload" href="/vuepressppr/assets/js/3.5bc5870a.js" as="script"><link rel="prefetch" href="/vuepressppr/assets/js/10.2686d00a.js"><link rel="prefetch" href="/vuepressppr/assets/js/11.fd30b52b.js"><link rel="prefetch" href="/vuepressppr/assets/js/12.fb774cab.js"><link rel="prefetch" href="/vuepressppr/assets/js/13.97058f82.js"><link rel="prefetch" href="/vuepressppr/assets/js/14.77172f79.js"><link rel="prefetch" href="/vuepressppr/assets/js/15.c64e7f5a.js"><link rel="prefetch" href="/vuepressppr/assets/js/16.3be1f0e5.js"><link rel="prefetch" href="/vuepressppr/assets/js/17.f3abe831.js"><link rel="prefetch" href="/vuepressppr/assets/js/18.aa42b649.js"><link rel="prefetch" href="/vuepressppr/assets/js/19.c99e69be.js"><link rel="prefetch" href="/vuepressppr/assets/js/20.d06df924.js"><link rel="prefetch" href="/vuepressppr/assets/js/21.84ee0397.js"><link rel="prefetch" href="/vuepressppr/assets/js/22.516a37df.js"><link rel="prefetch" href="/vuepressppr/assets/js/23.8f0194bb.js"><link rel="prefetch" href="/vuepressppr/assets/js/25.a2af72c5.js"><link rel="prefetch" href="/vuepressppr/assets/js/26.2fc3b743.js"><link rel="prefetch" href="/vuepressppr/assets/js/27.bc751e2b.js"><link rel="prefetch" href="/vuepressppr/assets/js/28.c7f5e694.js"><link rel="prefetch" href="/vuepressppr/assets/js/29.58bf1a2b.js"><link rel="prefetch" href="/vuepressppr/assets/js/30.b0b7273e.js"><link rel="prefetch" href="/vuepressppr/assets/js/31.3d7f955d.js"><link rel="prefetch" href="/vuepressppr/assets/js/32.65d1262f.js"><link rel="prefetch" href="/vuepressppr/assets/js/33.57f6c489.js"><link rel="prefetch" href="/vuepressppr/assets/js/34.62ba6309.js"><link rel="prefetch" href="/vuepressppr/assets/js/4.5f801113.js"><link rel="prefetch" href="/vuepressppr/assets/js/5.2b7133b0.js"><link rel="prefetch" href="/vuepressppr/assets/js/6.28e79f91.js"><link rel="prefetch" href="/vuepressppr/assets/js/7.a41c72a8.js"><link rel="prefetch" href="/vuepressppr/assets/js/8.c3a503dd.js"><link rel="prefetch" href="/vuepressppr/assets/js/9.11f50ff4.js">
    <link rel="stylesheet" href="/vuepressppr/assets/css/0.styles.47a93a5c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressppr/" class="home-link router-link-active"><!----> <span class="site-name">Padr√µes de Projetos</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/leandro-costa/vuepressppr" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/leandro-costa/vuepressppr" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Singleton (GOF) üî®</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepressppr/gof/Criacao/Singleton/#intencao" class="sidebar-link">Inten√ß√£o</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#motivacao" class="sidebar-link">Motiva√ß√£o</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#aplicabilidade" class="sidebar-link">Aplicabilidade</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#estrutura" class="sidebar-link">Estrutura</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#participantes" class="sidebar-link">Participantes</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#colaboracoes" class="sidebar-link">Colabora√ß√µes</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#consequencias" class="sidebar-link">Consequ√™ncias</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#implementacao" class="sidebar-link">Implementa√ß√£o</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#exemplo-de-codigo" class="sidebar-link">Exemplo de c√≥digo</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#usos-conhecidos" class="sidebar-link">Usos conhecidos</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#padrao-relacionados" class="sidebar-link">Padr√£o relacionados</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressppr/gof/Criacao/Singleton/#referencias" class="sidebar-link">Refer√™ncias</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="singleton-gof-üî®"><a href="#singleton-gof-üî®" class="header-anchor">#</a> Singleton (GOF) üî®</h1> <p><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p> <p>Em constru√ß√£o üöß</p> <h2 id="intencao"><a href="#intencao" class="header-anchor">#</a> Inten√ß√£o</h2> <p>Garantir que uma classe tenha somente uma inst√¢ncia e fornecer um ponto global de acesso para a mesma.</p> <h2 id="motivacao"><a href="#motivacao" class="header-anchor">#</a> Motiva√ß√£o</h2> <p>√â importante para algumas classes ter uma, e apenas uma, inst√¢ncia. Por exemplo, embora possam existir muitas impressoras em um sistema, deveria haver somente um spooler de impressoras. Da mesma forma, deveria haver somente um sistema de arquivos e um gerenciador de janelas. Um filtro digital ter√° somente um conversor A/ D. Um sistema de contabilidade ser√° dedicado a servir somente a uma companhia.</p> <p>Como garantimos que uma classe tenha somente uma inst√¢ncia e que essa inst√¢ncia seja facilmente acess√≠vel? Uma vari√°vel global torna um objeto acess√≠vel, mas n√£o impede voc√™ de instanciar m√∫ltiplos objetos.</p> <p>Uma solu√ß√£o melhor seria tornar a pr√≥pria classe respons√°vel por manter o controle da sua √∫nica inst√¢ncia. A classe pode garantir que nenhuma outra inst√¢ncia seja criada (pela intercepta√ß√£o das solicita√ß√µes para cria√ß√£o de novos objetos), bem como pode fornecer um meio para acessar sua √∫nica inst√¢ncia. Este √© o padr√£o Singleton.</p> <h2 id="aplicabilidade"><a href="#aplicabilidade" class="header-anchor">#</a> Aplicabilidade</h2> <p>Use o padr√£o Singleton quando:</p> <ul><li>for preciso haver apenas uma inst√¢ncia de uma classe, e essa inst√¢ncia tiver que dar acesso aos clientes atrav√©s de um ponto bem conhecido;</li> <li>a √∫nica inst√¢ncia tiver de ser extens√≠vel atrav√©s de subclasses, possibilitando aos clientes usar uma inst√¢ncia estendida sem alterar o seu c√≥digo.</li></ul> <h2 id="estrutura"><a href="#estrutura" class="header-anchor">#</a> Estrutura</h2> <figure><img src="https://www.plantuml.com/plantuml/svg/NOyn3eCm34Ltdy9ZkG9T6Bfqwi09ejIWIAdJ9ZyJukur2DI29zl_-UkxAt0PzHN9HrSAzq77A4Ww4LjD9YFucQk6JvMxsgnULgtiwCt17UcmSPVcI3xUaer8kWcZeFztiVLCf0d2KGPm6dw1sdPtvVKs2shMKx0hYJvvCQ3EEllh2m00" alt="uml diagram"> <figcaption>Estrutura Singleton.</figcaption></figure> <h2 id="participantes"><a href="#participantes" class="header-anchor">#</a> Participantes</h2> <ul><li>Singleton
<ul><li>define uma opera√ß√£o <code>instance</code> que permite aos clientes acessarem sua √∫nica inst√¢ncia. <code>instance</code> √© uma opera√ß√£o de classe.</li> <li>pode ser respons√°vel pela cria√ß√£o da sua pr√≥pria inst√¢ncia √∫nica.</li></ul></li></ul> <h2 id="colaboracoes"><a href="#colaboracoes" class="header-anchor">#</a> Colabora√ß√µes</h2> <p>‚Ä¢ Os clientes acessam uma inst√¢ncia Singleton unicamente pela opera√ß√£o <code>instance</code> do Singleton.</p> <h2 id="consequencias"><a href="#consequencias" class="header-anchor">#</a> Consequ√™ncias</h2> <p>O padr√£o Singleton apresenta v√°rios benef√≠cios:</p> <ol><li>Acesso controlado √† inst√¢ncia √∫nica. Como a classe Singleton encapsula a sua √∫nica inst√¢ncia, possui controle total sobre como e quando os clientes a acessam.</li> <li>Espa√ßo de nomes reduzido. O padr√£o Singleton representa uma melhoria em rela√ß√£o ao uso de vari√°veis globais. Ele evita a polui√ß√£o do espa√ßo de nomes com vari√°veis globais que armazenam inst√¢ncias √∫nicas.</li> <li>Permite um refinamento de opera√ß√µes e da representa√ß√£o. A classe Singleton pode ter subclasses e √© f√°cil configurar uma aplica√ß√£o com uma inst√¢ncia dessa classe estendida. Voc√™ pode configurar a aplica√ß√£o com uma inst√¢ncia da classe de que necessita em tempo de execu√ß√£o.</li> <li>Permite um n√∫mero vari√°vel de inst√¢ncias. O padr√£o torna f√°cil mudar de id√©ia, permitindo mais de uma inst√¢ncia da classe Singleton. Al√©m disso, voc√™ pode usar a mesma abordagem para controlar o n√∫mero de inst√¢ncias que a aplica√ß√£o utiliza. Somente a opera√ß√£o que permite acesso √† inst√¢ncia de Singleton necessita ser mudada(<a href="/nao_gof/Multiton">Multiton</a>, <a href="/nao_gof/ObjectPool">Object Pool</a>).</li> <li>Mais flex√≠vel do que opera√ß√µes de classe. Uma outra maneira de empacotar a funcionalidade de um singleton √© usando opera√ß√µes de classe (ou seja, fun√ß√µes-membro est√°ticas em C++ ou m√©todos de classe em Smalltalk). Por√©m, as t√©cnicas de ambas as linguagens tornam dif√≠cil mudar um projeto para permitir mais que uma inst√¢ncia de uma classe. Al√©m disso, as fun√ß√µes- membro est√°ticas em C++ nunca s√£o virtuais, o que significa que as subclasses n√£o podem redefini-las polimorficamente.</li></ol> <h2 id="implementacao"><a href="#implementacao" class="header-anchor">#</a> Implementa√ß√£o</h2> <p>A seguir apresentamos t√≥picos de implementa√ß√£o a serem considerados ao usar o
padr√£o Singleton:</p> <ol><li><p>Garantindo uma √∫nica inst√¢ncia. O padr√£o Singleton torna a inst√¢ncia √∫nica uma inst√¢ncia normal de uma classe, mas essa classe √© escrita de maneira que somente uma inst√¢ncia possa ser criada.</p> <p>Uma forma comum de fazer isso √© ocultando a opera√ß√£o que cria a inst√¢ncia usando uma opera√ß√£o de classe (isto √©, ou uma fun√ß√£o-membro est√°tica ou um m√©todo de classe) que garanta que apenas uma √∫nica inst√¢ncia seja criada. Esta opera√ß√£o tem acesso √† vari√°vel que mant√©m a √∫nica inst√¢ncia, e garante que a vari√°vel seja iniciada com a inst√¢ncia √∫nica antes de retornar ao seu valor. Esta abordagem assegura que um singleton seja criado e iniciado antes da sua primeira utiliza√ß√£o.</p> <p>Em C++, vo√ß√™ pode definir a opera√ß√£o de classe com uma fun√ß√£o-membro est√°tica Instance da classe Singleton. Singleton tamb√©m define uma vari√°vel-membro est√°tica <code>_instance</code> que cont√©m um apontador para sua √∫nica inst√¢ncia.</p> <p>A classe <code>Singleton</code> √© declarada como</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>class Singleton <span class="token punctuation">{</span>
public<span class="token operator">:</span>
    <span class="token keyword">static</span> Singleton<span class="token operator">*</span> <span class="token function">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
protected<span class="token operator">:</span>
    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
private<span class="token operator">:</span>
    <span class="token keyword">static</span> Singleton<span class="token operator">*</span> _ instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>A implementa√ß√£o correspondente √© a seguinte</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>Singleton<span class="token operator">*</span> Singleton<span class="token operator">::</span>_instance <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

Singleton<span class="token operator">*</span> Singleton<span class="token operator">::</span><span class="token function">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _instance <span class="token operator">=</span> new Singleton<span class="token punctuation">;</span>
    <span class="token keyword">return</span> _instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Os clientes acessam o singleton atrav√©s da fun√ß√£o membro <code>Instance</code>. A vari√°vel <code>_instance</code> √© iniciada com 0, e a fun√ß√£o-membro est√°tica <code>Instance</code> retorna o seu valor, iniciando-a com a √∫nica inst√¢ncia se ele for 0. <code>Instance</code> usa <em>lazy initialization</em>; o valor que ela retorna n√£o √© criado e armazenado at√© ser acessado pela primeira vez.</p> <p>Note que o constructor √© protegido. Um cliente que tenta instanciar <code>Singleton</code> diretamente obter√° como resposta um erro em tempo de compila√ß√£o. Isto assegura que somente uma inst√¢ncia possa ser criada.</p> <p>Al√©m do mais, uma vez que <code>_instance</code> √© um apontador para um objeto <code>Singleton</code>, a fun√ß√£o-membro Instance pode atribuir um apontador para uma subclasse de <code>Singleton</code> para esta vari√°vel. Daremos um exemplo do que dissemos aqui na se√ß√£o Exemplo de c√≥digo.</p> <p>H√° uma outra coisa a ser observada sobre a implementa√ß√£o em C++. N√£o √© suficiente definir o singleton como um objeto global ou est√°tico, confiando numa inicializa√ß√£o autom√°tica. Existem tr√™s raz√µes para isto:</p> <ul><li>n√£o podemos garantir que somente uma inst√¢ncia de um objeto est√°tico ser√° declarada;</li> <li>talvez n√£o tenhamos informa√ß√£o suficiente para instanciar cada singleton em tempo de inicializa√ß√£o est√°tica. Um singleton pode necessitar de valores que s√£o computados mais tarde, durante a execu√ß√£o do programa;</li> <li>C++ n√£o define a ordem pela qual os construtores para objetos globais s√£o chamados entre unidades de compila√ß√£o [ES90]. Isso significa que n√£o podem existir depend√™ncias entre singletons; se alguma existir, ent√£o √© inevit√°vel a ocorr√™ncia de erro.</li></ul> <p>Uma defici√™ncia adicional (embora pequena) da abordagem objeto global/ est√°tico √© que ela for√ßa a cria√ß√£o de todos singletons, quer sejam usados ou n√£o. O uso de uma fun√ß√£o-membro est√°tica evita todos estes problemas. Em Smalltalk, a fun√ß√£o que retorna a inst√¢ncia √∫nica √© implementada como um m√©todo de classe da classe Singleton. Para garantir que somente uma inst√¢ncia seja criada, redefine-se a opera√ß√£o new. A classe Singleton resultante pode ter os seguintes m√©todos de classe, em que <code>SoleInstance</code> √© uma vari√°vel de classe que n√£o √© usada em nenhum outro lugar.</p> <div class="language-smalltalk line-numbers-mode"><pre class="language-smalltalk"><code><span class="token keyword">new</span>
    <span class="token operator">-</span> <span class="token keyword">self</span> error<span class="token punctuation">:</span> <span class="token string">'cannot create new object'</span>
default
    SoleInstance isNil ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span>Solelnstance <span class="token operator">:=</span> <span class="token keyword">super</span> <span class="token keyword">new</span><span class="token punctuation">]</span><span class="token punctuation">.</span>
    <span class="token operator">^</span> Soleinstance
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>Criando subclasses da classe Singleton. O ponto principal n√£o √© a defini√ß√£o da subclasse, mas sim a instala√ß√£o da sua √∫nica inst√¢ncia de maneira que os clientes possam ser capazes de us√°-la. Em ess√™ncia, a vari√°vel que referencia a inst√¢ncia do singleton deve ser iniciada com uma inst√¢ncia da subclasse. A t√©cnica mais simples √© determinar qual singleton voc√™ quer usar na opera√ß√£o Instance do Singleton. Um exemplo na se√ß√£o de Exemplo mostra como implementar essa t√©cnica com vari√°veis do ambiente (operacional). Uma outra maneira de escolher a subclasse de Singleton √© retirar a implementa√ß√£o de Instance da classe-m√£e (por exemplo, MazeFactory) e coloc√°-la na subclasse. Isto permite a um programador C++ decidir a classe do singleton em tempo de &quot;Linkedi√ß√£o&quot; (link-time), mantendo-a oculta dos seus clientes (por exemplo, fazendo a liga√ß√£o com um arquivo-objeto que cont√©m uma implementa√ß√£o diferente).
A solu√ß√£o da liga√ß√£o fixa a escolha da classe do singleton em tempo de &quot;linkedi√ß√£o&quot;, o que torna dif√≠cil escolher a classe do singleton em tempo de execu√ß√£o. O uso de instru√ß√µes condicionais para determina√ß√£o da subclasse √© mais flex√≠vel, por√©m codifica de maneira r√≠gida o conjunto das classes Singleton poss√≠veis. Nenhuma abordagem √© flex√≠vel o bastante em todos os casos.
Uma abordagem mais flex√≠vel utiliza um sistema de registro de singletons (registry of singletons). Em vez de ter Instance definindo o conjunto das classes Singleton poss√≠veis, as classes Singleton podem registrar suas inst√¢ncias singleton por nome, num sistema de registro de conhecimento geral. O sistema de registro associa nomes e singletons. Os nomes s√£o constitu√≠dos de cadeias de caracteres. Quando Instance necessita um singleton, ela consulta o sistema de registro, procurando o singleton pelo nome. O sistema de registro procura o singleton correspondente (se existir) e o retorna ao cliente. Essa solu√ß√£o libera Instance da necessidade de ter que conhecer todas as poss√≠veis classes ou inst√¢ncias do Singleton. Tudo o que √© necess√°rio √© uma interface comum para todas as classes Singleton, que inclua opera√ß√µes de registro:</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>class Singleton <span class="token punctuation">{</span>
public<span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">,</span> Singleton<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">static</span> Singleton<span class="token operator">*</span> <span class="token function">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
protected<span class="token operator">:</span>
    <span class="token keyword">static</span> Singleton<span class="token operator">*</span> <span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span> <span class="token punctuation">;</span>
private<span class="token operator">:</span>
    <span class="token keyword">static</span> Singleton<span class="token operator">*</span> _ instance<span class="token punctuation">;</span>
    <span class="token keyword">static</span> List<span class="token operator">&lt;</span>NameSingletonPair<span class="token operator">&gt;</span><span class="token operator">*</span> _registry<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ol> <p>Register registra a inst√¢ncia de Singleton com um nome fornecido. Para manter o registro simples, necessitaremos que armazene uma lista de objetos <code>NameSingletonPair</code>. Cada <code>NameSingletonPair</code> mapeia (associa) um nomea um singleton. Dado um nome, a opera√ß√£o <code>Lookup</code> encontra o singleton correspondente. Assumiremos que uma vari√°vel do ambiente especifica o nome do singleton desejado.</p> <p>Singleton‚Ä¢ Singleton:: Instance ( ) {
i f (_instance
const char‚Ä¢ singletonName = ;
/ / usu√°rio ou ambiente fornece esse valor no in√≠cio da execu√ß√£o
_ instance = Lookup (singletonName) ;
// l√£)kup retorna O se n√£o h√° qualquer singleton com o nome verificado
return _ instance;</p> <p>Onde as classes Singleton registram a si mesmas? Uma possibilidade √© faz√™-
10 no seu constructor. Por exemplo, uma subclasse MySing1eton poderia
fazer o seguinte:</p> <p>MySingIeton:: ( ) (
Singleton:: Register( &quot;MySing1eton*, this) ;</p> <p>Naturalmente, o construtor n√£o ser√° chamado a menos que algu√©m instancie
a classe, o que repete o problema que o padr√£o Singleton est√° tentando resolver!
N√≥s podemos contornar este problema em C++ atrav√©s da defini√ß√£o de uma
inst√¢ncia est√°tica de MySingleton. Por exemplo, podemos definir</p> <p>static MySing1eton theSingIeton;</p> <p>no arquivo que cont√©m a implementa√ß√£o de MySingleton.</p> <p>A classe Singleton n√£o √© mais respons√°vel pela cria√ß√£o do singleton. Em vez
disso, sua responsabilidade prim√°ria √© tornar acess√≠vel o objeto singleton
escolhido no sistema. A solu√ß√£o que usa o objeto est√°tico ainda apresenta um
problema potencial ‚Äî todas as inst√¢ncias de todas as subclasses poss√≠veis de
Singleton devem ser criadas, pois, caso contr√°rio, n√£o ser√£o registradas.</p> <h2 id="exemplo-de-codigo"><a href="#exemplo-de-codigo" class="header-anchor">#</a> Exemplo de c√≥digo</h2> <p>Suponha que definimos uma classe MazeFactory para construir labirintos. MazeFactory define uma interface para constru√ß√£o de diferentes partes de um labirinto. As subclasses podem redefinir as opera√ß√µes para retornar inst√¢ncias de classes-produtos especializadas, tal como BombedWall no lugar de simples Objetos Wall.</p> <p>O fato relevante aqui √© que a aplica√ß√£o Maze necessita somente de uma inst√¢ncia de uma f√°brica de labirintos, e que essa inst√¢ncia dever√° estar dispon√≠vel para o c√≥digo que construir qualquer parte do labirinto. √â a√≠ que o padr√£o Singleton entra. Ao tornar MazeFactory um singleton, n√≥s tornamos o objeto-labirinto (maze) acess√≠vel global- mente sem recorrer a vari√°veis globais.</p> <p>Para simplificar, suponhamos que nunca criaremos subclasses de Ma zeFactory (a alternativa ser√° considerada mais √† frente). N√≥s tornamos Ma uma classe Singleton em C++, acrescentando uma opera√ß√£o est√°tica Instance e um membro est√°tico <code>_instance</code> para conter a √∫nica inst√¢ncia existente. Tamb√©m devemos proteger o constructor para prevenir instancia√ß√µes acidentais, as quais nos levariam a ter mais que uma inst√¢ncia.</p> <p>class MazeFactory {
publ i c :
static MazeFactory* Instance ( ) ;
// interface existente vai aqui
protected:
MazeFactory ) ;
private:
static MazeFactory* _ instance;</p> <p>A implementa√ß√£o correspondente √©
MazeFactory* MazeFactory; : _ instance = C
MazeFactory* MazeFactory:: Instance ( ) (
ii (_instance O) {
_ instance new MazeFactory ;
return _instance;</p> <p>Agora verificaremos o que acontece quando existem subclasses de Ma zeFactory
e a aplica√ß√£o tem que decidir qual delas usar. Selecionaremos o tipo de labirinto atrav√©s
de uma vari√°vel do ambiente e acrescentaremos o c√≥digo que instancia a subclasse
apropriada de Ma z eFac tory com base no valor da vari√°vel do ambiente. Um bom lugar
para colocar este c√≥digo √© a opera√ß√£o Instance, porque ela j√° instancia MazeFactory:</p> <p>MazeFactory* MazeFactory :: Instance C) (
i f C ‚Äîinstance ‚Äî
const chars mazeStyle = getenv( ) ;
i f (strcmp (mazestyle, ‚Ä¢ bombed&quot;) O) (
_ instance = new BombedMazeFactory;
) else it (strcmp (mazeStyIe, &quot;enchanted&quot;}
_ instance = new EnchantedMazeFactory;
outras subclasses poss√≠veis
) else {
// default
_ instance = new MazeFactory;
return _ instance;</p> <p>Note que Instance deve ser modificada toda vez que voc√™ define uma nova subclasse de MazeFactory. Isso pode n√£o ser um problema nesta aplica√ß√£o, mas pode ser um problema para as f√°bricas abstratas definidas num framework.</p> <p>Uma solu√ß√£o poss√≠vel seria usar a t√©cnica do uso de um sistema de registro descrita na se√ß√£o Implementa√ß√£o. A liga√ß√£o din√¢mica (dynamic linking) poderia tamb√©m ser √∫til aqui ‚Äîela evitaria que a aplica√ß√£o tivesse que carregar para a mem√≥ria todas as subclasses que n√£o s√£o usadas.</p> <h2 id="usos-conhecidos"><a href="#usos-conhecidos" class="header-anchor">#</a> Usos conhecidos</h2> <p>Um exemplo do padr√£o Singleton em Smalltalk-80 [Par90] √© o conjunto de mudan√ßas no c√≥digo efetuado por ChangeSet current. Um exemplo mais sutil √© o relacionamento entre classes e suas metaclasses. Uma metaclasse √© a classe de uma classe, e cada metaclasse tem uma inst√¢ncia. As metaclasses n√£o t√™m nomes (exceto indiretamente, atrav√©s do nome da sua √∫nica inst√¢ncia), mas registram e acompanham a sua √∫nica inst√¢ncia, e normalmente n√£o criar√£o outra.</p> <p>O toolkit para constru√ß√£o de interfaces de usu√°rio Inter Views [LCI*92] usa o padr√£o Singleton para acessar as √∫nicas inst√¢ncias de suas classes Session e WidgetKit, entre outras. Session define o ciclo de eventos dispar√°veis da aplica√ß√£o principal, armazena o banco de dados das prefer√™ncias de estilo do usu√°rio e administra conex√µes para um ou mais dispositivos f√≠sicos de display. WidgetKit √© uma Abstract Factory (95) para definir os widgets de estilo de intera√ß√£o. A opera√ß√£o WidgetKit:: instance determina a subclasse espec√≠fica de WidgetKit que √© instanciada baseada numa vari√°vel de ambiente que Session define. Uma opera√ß√£o similar em determina se s√£o suportados displays monocrom√°ticos ou coloridos e configura a inst√¢ncia singleton de Session de acordo.</p> <h2 id="padrao-relacionados"><a href="#padrao-relacionados" class="header-anchor">#</a> Padr√£o relacionados</h2> <p>Muitos padr√µes podem ser implementados usando Singleton. Ver <a href="/gof/AbstractFactory">Abstract Factory</a>, <a href="/gof/Builder">Builder</a> e <a href="/gof/Prototype">Prototype</a>.</p> <h2 id="referencias"><a href="#referencias" class="header-anchor">#</a> Refer√™ncias</h2> <hr class="footnotes-sep"> <section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>GAMMA, Erich. et al. Padr√µes de projetos: Solu√ß√µes reutiliz√°veis de software orientados a objetos Bookman editora, 2009. <a href="#fnref1" class="footnote-backref">‚Ü©Ô∏é</a></p></li></ol></section></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/leandro-costa/vuepressppr/edit/master/src/gof/Criacao/Singleton/README.md" target="_blank" rel="noopener noreferrer">Edit!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/13/2022, 10:48:24 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/vuepressppr/03_GOF.html" class="prev">
        GOF üî®
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/vuepressppr/assets/js/app.8ac43990.js" defer></script><script src="/vuepressppr/assets/js/2.63c38da0.js" defer></script><script src="/vuepressppr/assets/js/24.ecdeccbb.js" defer></script><script src="/vuepressppr/assets/js/3.5bc5870a.js" defer></script>
  </body>
</html>
